# P115StrgmSubPansou - 115网盘订阅追更插件(PanSou高频版)

MoviePilot 插件，自动将订阅的电影和电视剧从 115 网盘分享链接转存到个人网盘。

**本版本特性：专为PanSou搜索优化，移除8小时调度限制，支持更高频的资源搜索。**

## 完整工作流

本插件配合 [115网盘STRM助手](https://github.com/DDSRem-Dev/MoviePilot-Plugins) 可实现完整的自动化追剧流程：

```
MoviePilot订阅 -> 本插件搜索转存 -> STRM助手生成STRM -> 媒体库刮削 -> 播放器观看
```

## 功能特点

- **支持电影和电视剧**订阅自动追更
- **三重搜索源**：Nullbr（TMDB ID 精准匹配）+ PanSou（网盘聚合搜索）+ HDHive（支持Playwright和API模式）
- **智能匹配**：支持 S01E01、第X集、EP01 等多种命名格式
- **洗版模式**：自动升级更高质量资源（基于订阅的质量/分辨率/特效设置）
- **订阅过滤**：继承 MoviePilot 订阅的质量、分辨率、特效过滤条件
- **屏蔽系统订阅**：可阻止 MoviePilot 默认的订阅下载，仅使用本插件转存
- **避免重复**：自动检查网盘已有文件和历史记录
- **自动完成订阅**：转存完成后自动标记订阅完成
- **防风控机制**：批量转存、速率限制、智能重试
- **🎯 高频搜索**：移除8小时限制，支持PanSou更频繁的资源搜索（如每2小时、每4小时等）

## 与原版的区别

| 特性 | 原版 (p115strgmsub) | PanSou版 (p115strgmsub_pansou) |
|------|---------------------|--------------------------------|
| 插件ID | `p115strgmsub` | `p115strgmsub_pansou` |
| 最低调度间隔 | 8小时强制限制 | 无限制，用户自定义 |
| 适用场景 | 一般追更需求 | 需要高频搜索PanSou资源 |
| 配置前缀 | `p115strgmsub_` | `p115strgmsub_pansou_` |

## 依赖

```bash
pip install p115client>=0.0.8.2 sqlitetools>=0.0.7 playwright
```

## 配置说明

### 基础配置

| 配置项 | 说明 |
|--------|------|
| 启用插件 | 开启/关闭插件 |
| 发送通知 | 转存完成后发送消息通知 |
| 执行周期 | cron表达式，**无最低8小时限制**，如 `0 */2 * * *` 每2小时执行 |
| 电视剧转存目录 | 默认 `/我的接收/MoviePilot/TV` |
| 电影转存目录 | 默认 `/我的接收/MoviePilot/Movie` |

### 115 网盘配置

填入 115 Cookie（可从115网盘STRM助手复制）

### 搜索源配置

插件支持三个搜索源，按优先级自动回退。可同时启用多个，若当前源找不到资源会自动尝试下一个。

**Nullbr**（TMDB精准匹配）:
- APP ID 和 API Key
- 基于 TMDB ID 查询，准确率高

**PanSou**（网盘聚合搜索）:
- API 地址、用户名/密码（可选认证）
- TG 搜索频道（可选），为空的话将搜索 PanSou 默认频道
- 资源丰富，但需要通过标题匹配

**HDHive**（Hdhive站点搜索）:
- 支持 Playwright 和 API 两种模式
- Playwright 模式：需要用户名和密码
- API 模式：需要 Cookie（支持自动刷新）

### 高级配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 只搜索115资源 | 开启 | PanSou 搜索时只返回115网盘资源 |
| 屏蔽系统订阅 | 关闭 | 阻止 MoviePilot 默认订阅处理 |
| 排除订阅 | - | 指定不处理的订阅ID（逗号分隔） |
| 单次同步最大转存数 | 50 | 防风控限制 |
| 批量转存每批数量 | 20 | 批量转存时每批文件数 |
| 跳过其他季目录 | 开启 | 减少不必要的 API 调用 |

## 转存路径结构

```
电视剧: {电视剧目录}/{剧名}/Season {季号}/
电影:   {电影目录}/{片名} ({年份})/
```

## UI 统计功能

插件提供详细的统计信息展示：
- 总转存数、今日转存、成功率
- 电影/剧集分类统计
- 最近同步时间
- 历史记录列表（支持清空）

## 远程命令

支持通过 MoviePilot 消息触发同步：
```
/p115_sub_action
```

## 使用方法

1. 在 MoviePilot 插件管理中安装本插件
2. 配置 115 Cookie
3. 配置至少一个搜索源（Nullbr 或 PanSou 或 HDHive）
4. 在 MoviePilot 中添加订阅
5. 设置合适的执行周期（如每2小时：`0 */2 * * *`）
6. 启用插件，等待定时任务执行或点击"立即搜索"按钮

## 高频搜索示例

由于移除了8小时限制，你可以设置更频繁的搜索：

```bash
# 每2小时执行
0 */2 * * *

# 每4小时执行
0 */4 * * *

# 每小时执行
0 * * * *

# 每30分钟执行（极高频，请谨慎使用）
*/30 * * * *
```

## 注意事项

- 115 Cookie 有效期有限，失效后需重新获取
- 搜索结果取决于资源库收录情况
- 洗版模式需要在订阅中开启"洗版"选项
- 建议合理设置转存数量限制，避免触发 115 风控
- ⚠️ **高频搜索可能增加API调用压力，请根据实际需求合理设置执行周期**
- 本版本与原版使用不同的插件ID，可以同时安装但不建议同时启用

## 版本历史

### v1.0.0 (2026-01-29)
- Fork自原版 p115strgmsub
- 移除8小时调度限制
- 更新插件ID为 p115strgmsub_pansou
- 支持用户自定义任意频率的执行周期
- 优化PanSou高频搜索场景

## 致谢

本插件基于 [mrtian2016/p115strgmsub](https://github.com/mrtian2016) 开发，感谢原作者的贡献。

## License

MIT License
